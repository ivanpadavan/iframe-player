"use strict";(self.webpackChunkiframe_player=self.webpackChunkiframe_player||[]).push([[500],{7500:(Y,y,s)=>{s.r(y),s.d(y,{SmartShakaPlayer:()=>M});var d=s(467),m=s(2771),T=s(4843),k=s(7468),f=s(3726),P=s(5964),S=s(5558),E=s(7673),b=s(5454),L=s(8141),A=s(1594),C=s(6354),w=s(1501),x=s(3538),D=s.n(x),p=s(5755),o=s(8970),g=s(1880),I=s(5985);class B extends p.O{constructor(i,e,r){super(i),this.player=e,this.playerData=r,this.type="streaming"}get isAutoQuality(){return this.player.getConfiguration()?.abr?.enabled}get currentTime(){return this.videoElement.currentTime}get duration(){return this.videoElement.duration}getTextTracks(){const i=this.videoElement.classList.contains("hide-subtitles");return this.player.getTextTracks().map(e=>({...e,id:e.id.toString(),kind:e.kind,active:!i&&e.active}))}getVideoTracks(){return this.getUniqueTracks("videoId").map(i=>({active:i.active,id:i.id,label:i.label,width:i.width,height:i.height,videoBandwidth:i.videoBandwidth}))}getAudioTracks(){return this.getUniqueTracks("audioId").map(i=>({active:i.active,id:i.id,label:i.label,language:i.language,audioBandwidth:i.audioBandwidth}))}get isLiveStream(){return this.player.isLive()}get liveStreamCurrentTime(){return this.player.getPlayheadTimeAsDate()}get availabilityStartTime(){return this.player.getPresentationStartTimeAsDate()}get seekRange(){return this.player.seekRange()}get currentManifest(){return this.playerData.currentManifest}get hasTimeShiftManifest(){return this.playerData.hasTimeShiftManifest}get manifestType(){return this.playerData.manifestType}getUniqueTracks(i){const e=this.player.getVariantTracks(),r=e.find(n=>n.active),t="videoId"===i?"audioId":"videoId",a=(r||e[0])[t];return e.filter(n=>n[t]===a)}}const l=s(8495);class N{constructor(){this.srtLines=[]}parse(i,e=0){const r=(i=i.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m);if(!r||!r.length)throw new l.util.Error(l.util.Error.Severity.RECOVERABLE,l.util.Error.Category.TEXT,l.util.Error.Code.INVALID_TEXT_HEADER);const t=[];for(const a of r){const n=a.split("\n"),h=this.parseCue(n,e);h&&t.push(h)}return this.srtLines=t,this.srtLines}parseCue(i,e){if(1===i.length&&!l.text[0])return null;i[0].includes("--\x3e")||i.splice(0,1);const r=i[0].split("--\x3e"),t=r[0].replace(/\s+/g,"").replace(",",":").split(":"),a=r[1].replace(/\s+/g,"").replace(",",":").split(":");let n,h;try{n=this.parseTime(t[0],t[1],t[2],t[3]),h=this.parseTime(a[0],a[1],a[2],a[3])}catch{return null}e&&(n+=e,h+=e);const c=i.slice(1).join("\n").trim();return new l.text.Cue(n,h,c)}parseTime(i,e,r,t){return(t&&0!=+t?t/1e3:0)+(+r||0)+60*(+e||0)+3600*(+i||0)}}class R{constructor(){this.srtParser=new N}parseInit(){}parseMedia(i,e){const r=l.util.StringUtils.fromUTF8(i);return this.srtParser.parse(r,e.segmentStart)}}var F=l.util.FakeEvent;let M=(()=>{class u extends p.N{static{this.polyfillInstalled=!1}constructor(){super(g.I9),this.type="streaming",this.playerType="smart-shaka",this.playerData={},this.GlobalDebuggerObjectName="gl-pl-debugger",this.restartCount=0,this.shakaErrorListener=this.handleShakaPlayerErrorEvent.bind(this),this.waitingStartSeek=!1,this.reloadOnNetworkError=!1,this.destroy$=new m.m(1),this.responseFilter=(e,r)=>{if(e===l.net.NetworkingEngine.RequestType.MANIFEST)try{const t=new TextDecoder("utf-8").decode(r.data);if(0===t.indexOf("<?xml")){const a=(new DOMParser).parseFromString(t,"application/xml");this.processSCTE35(a),a.querySelectorAll("AdaptationSet").forEach(h=>{if(h.getAttribute("label")?.includes("5.1")){h.setAttribute("lang",h.getAttribute("lang")+"5.1");const c=h.querySelector("AudioChannelConfiguration");"urn:mpeg:dash:23003:3:audio_channel_configuration:2011"===c?.getAttribute("schemeIdUri")&&c.setAttribute("value","6")}}),r.data=(new TextEncoder).encode((new XMLSerializer).serializeToString(a)).buffer}}catch(t){console.error(t)}}}init(e,r){var t=()=>super.init,a=this;return(0,d.A)(function*(){if(yield u.checkPolyfillInstalled(),!l.Player.isBrowserSupported())throw new o.Mk(o.Yq.BrowserNotSupportedError,"Browser not supported!");a.shakaPlayer=new l.Player(e),a.shakaPlayer.getNetworkingEngine().registerResponseFilter(a.responseFilter),window.player=a.shakaPlayer,yield t().call(a,e,r)})()}initState(){this.state=new B(this.video,this.shakaPlayer,this.playerData)}configure(e){var r=()=>super.configure,t=this;return(0,d.A)(function*(){yield r().call(t,{...e}),t.firstConfigured||(t.shakaPlayer.configure({preferredAudioLanguage:"ru",preferredTextLanguage:"ru"}),t.firstConfigured=!0),t.shakaPlayer.configure(e.configData)})()}handlePlayerVideoEvent(e){super.handlePlayerVideoEvent(e)}handleShakaPlayerErrorEvent(e){var r=this;return(0,d.A)(function*(){(0,o.Yi)(e),r.listener(e);const t=(0,o.uZ)(e);if((!t||r.reloadOnNetworkError)&&e.detail?.code!==l.util.Error.Code.LOAD_INTERRUPTED)if(2===e.detail?.severity&&r.config.errorBehaviour){const a=r.config.errorBehaviour;if("restart"===a.onCriticalError&&r.restartCount<a.maxRestartCount){(0,o.Yi)("\u0411\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a \u043f\u043b\u0435\u0435\u0440\u0430, \u0441 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435\u043c \u043f\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 +1 \u0441\u0435\u043a\u0443\u043d\u0434\u0430,\n         \u0442\u0430\u043a \u043a\u0430\u043a \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430, \u0438\u0437-\u0437\u0430 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043c\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u043c \u0438\u0433\u0440\u0430\u0442\u044c ");const n=r.video.currentTime;return yield r.shakaPlayer.unload(),t||(r.restartCount+=1),void(yield r.shakaPlayer.load(r.playerData.currentSrc,n+1).catch(h=>r.handleShakaPlayerErrorEvent(new F("error",{detail:h}))))}(0,o.Yi)("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u043b\u0435\u0435\u0440\u0430, \u043d\u043e \u043c\u044b \u0443\u0436\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u043b\u0438 \u043f\u043b\u0435\u0435\u0440 \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u043e \u043f\u043e \u043a\u043e\u043d\u0444\u0438\u0433\u0443")}else(0,o.Yi)("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u043b\u0435\u0435\u0440\u0430, \u043d\u043e \u0432 \u043a\u043e\u043d\u0444\u0438\u0433\u0435 \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043f\u0440\u0438 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043e\u0448\u0438\u0431\u043a\u0435")})()}setListeners(){this.shakaPlayer.addEventListener("error",this.shakaErrorListener);for(const e of this.eventsList)g.r$.includes(e)?"error"!==e&&this.video.addEventListener(e,this.listener):this.shakaPlayer.addEventListener(e,this.listener)}removeListeners(){this.shakaPlayer.removeEventListener("error",this.shakaErrorListener);for(const e of this.eventsList)g.r$.includes(e)&&"error"!==e?this.video.removeEventListener(e,this.listener):this.shakaPlayer.removeEventListener(e,this.listener)}detach(){var e=()=>super.detach,r=this;return(0,d.A)(function*(){return yield e().call(r),r.destroy$.next(),r.shakaPlayer.destroy()})()}isBrowserSupported(){return l.Player.isBrowserSupported()}setSubtitlesContainer(e){const r=this.video;this.shakaPlayer.configure("textDisplayFactory",function(){return new l.text.UITextDisplayer(r,e)})}addSubtitle(e){var r=()=>super.addSubtitle,t=this;return(0,d.A)(function*(){if(t.shakaPlayer.getManifest()){let a=e.src;-1!==e.src.indexOf(".srt")&&(a=yield D()(yield fetch(e.src).then(n=>n.blob()))),yield t.shakaPlayer.addTextTrackAsync(a,e.language,"subtitles","text/vtt","",e.label)}else yield r().call(t,e)})()}load(e){var r=()=>super.load,t=this;return(0,d.A)(function*(){t.reloadOnNetworkError=e.reloadOnNetworkError,yield t.unload(),yield r().call(t,e);try{yield t.shakaLoad(e.playUrl,e.startTime),t.afterLoad()}catch(a){a.code!==l.util.Error.Code.INVALID_TEXT_HEADER&&((0,o.Yi)("Shaka load error:",a),t.events$.next({type:"error",detail:a}))}})()}selectVideoTrack(e){"auto"!==e?(this.setAbrState(!1),this.selectVariantTrack(e)):this.setAbrState(!0)}selectVariantByLabel(e){e&&this.shakaPlayer.selectVariantsByLabel(e)}selectTextTrack(e){if(this.video.classList[e?"remove":"add"]("hide-subtitles"),!e)return this.shakaPlayer.setTextTrackVisibility(!1),void(0,o.Wz)("subtitle hide");const t=this.shakaPlayer.getTextTracks().find(a=>a.id===+e);t?(this.shakaPlayer.setTextTrackVisibility(!0),this.shakaPlayer.selectTextTrack(t)):(0,o.Yi)("selectTextTrack error")}selectAudioTrack(e,r){const t=this.state.getAudioTracks(),a=(t.find(n=>n.label===r)||t.find(n=>n.language===e))?.id;this.selectVariantTrack(a)}shakaLoad(e,r){var t=this;return(0,d.A)(function*(){return(0,o.Wz)(`load manifest ${e}`),t.restartCount=0,t.playerData.currentSrc=e,t.playerData.manifestType=function O(u){switch(!0){case u.includes(".m3u8"):return"hls";case u.includes(".mp4"):return"mp4";default:return"mpeg-dash"}}(e),(0,T._)((0,k.p)([t.shakaPlayer.load(e,r??null),(0,f.R)(t.shakaPlayer,"onstatechange").pipe((0,P.p)(a=>"src-equals"===a.state||"load"===a.state),(0,S.n)(({state:a})=>"load"===a?(0,E.of)(void 0):(0,b.O)((0,f.R)(t.video,"loadedmetadata"),(0,f.R)(t.video,"error").pipe((0,L.M)(()=>{throw new Error("video error while loading")})))),(0,A.$)())]).pipe((0,C.T)(()=>{})))})()}setCurrentTime(e){this.waitingStartSeek||super.setCurrentTime(e)}setCurrentTimeInUTC(e){if(this.waitingStartSeek)return;if(!this.shakaPlayer.isLive())return void(0,o.Yi)("\u0411\u044b\u043b \u0432\u044b\u0437\u0432\u0430\u043d \u043c\u0435\u0442\u043e\u0434 setCurrentTimeInUTC \u0434\u043b\u044f \u043d\u0435\u043b\u0430\u0439\u0432\u043e\u0433\u043e \u043f\u043e\u0442\u043e\u043a\u0430!");const r=Number(e)-Number(this.state.seekRange.start);this.shakaPlayer.seekRange().end<r?((0,o.Wz)("\u0423\u0445\u043e\u0434\u0438\u043c \u0432 \u043f\u0440\u044f\u043c\u043e\u0439 \u044d\u0444\u0438\u0440, \u0442\u0430\u043a \u043a\u0430\u043a \u043d\u0443\u0436\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u0437\u0430 \u043e\u043a\u043d\u043e\u043c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0433\u043e"),this.goToLive()):((0,o.Wz)("\u041f\u0440\u043e\u0441\u0442\u0430\u044f \u043f\u0435\u0440\u0435\u043c\u043e\u0442\u043a\u0430 \u0432\u043d\u0443\u0442\u0440\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u043f\u043e\u0442\u043e\u043a\u0430"),this.video.currentTime=r)}goToLive(){(0,o.Wz)("\u0412\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f goToLive",{playerData:this.playerData}),this.shakaPlayer.goToLive()}addGlobalDebugger(){const e=localStorage.getItem("shaka-level");e&&l?.log?.setLevel(Number(e)),window[this.GlobalDebuggerObjectName]={player:this.shakaPlayer,stats:()=>this.shakaPlayer.getStats(),drminfo:()=>this.shakaPlayer.drmInfo(),configuration:()=>this.shakaPlayer.getConfiguration(),bufferfullness:()=>this.shakaPlayer.getBufferFullness(),bufferedinfo:()=>this.shakaPlayer.getBufferedInfo(),configure:(r,t)=>{"string"==typeof r&&void 0!==t?this.shakaPlayer.configure(r,t):this.shakaPlayer.configure(r)}}}unload(){var e=this;return(0,d.A)(function*(){yield e.shakaPlayer.unload(!0)})()}removeGlobalDebugger(){window[this.GlobalDebuggerObjectName]=null}afterLoad(){super.afterLoad()}selectVariantTrack(e){const r=this.shakaPlayer.getVariantTracks().find(t=>t.id===+e);if(r)try{this.shakaPlayer.selectVariantTrack(r,!0)}catch(t){console.error(t)}else e&&(0,o.Yi)("selectVariantTrack error")}setAbrState(e){this.shakaPlayer.getConfiguration().abr?.enabled!==e&&this.shakaPlayer.configure({abr:{enabled:e}})}static checkPolyfillInstalled(){return(0,d.A)(function*(){(0,o.Wz)("shaka version is",l.Player.version),u.polyfillInstalled||(l.polyfill.installAll(),l.text.TextEngine.registerParser("text/srt",()=>new R),u.polyfillInstalled=!0)})()}processSCTE35(e){const r=e.querySelector("EventStream"),t=r?.querySelector("Event");if(t){const a=+r.getAttribute("timescale"),n=+t.getAttribute("presentationTime")/a,h=+t.getAttribute("duration")/a,c=(0,I.gB)(()=>{const v=(new w.S).parseFromB64(t.querySelector("Binary")?.textContent);if("uniqueProgramId"in v.spliceCommand)return v.spliceCommand.uniqueProgramId.toString()});this.handlePlayerVideoEvent({type:"scte35",presentationTime:n,duration:h,uniqueProgramId:c})}}}return u})()}}]);